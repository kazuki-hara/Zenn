---
title: "AWS試験対策: AWS Systems Manager"
emoji: "🐙"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

# 概要

インスタンスにパッチを当てるために利用される。無料

## 主な設定項目や仕様

- インスタンスにエージェントをインストールする必要がある。Amazon Linuxや一部のUbuntuのAMIには最初からインストールされている
- インスタンスプロファイルににAmazonSSMManagerInstanceポリシーを持つIAMロールを割り当てる必要がある。
- インスタンスにインバウンドルールをつけなくても、エージェントがSSMにアクセスするから問題ない

### リソースグループ

- Tagをつけてリソースグループを作成する
- 本番環境と開発環境でタグを分けるなど
- Ec2以外にもS3やDynamoDBやLambdaなど
- グループ単位でOSにパッチを当てるなど、SSMの操作をできる

### ドキュメント

- jsonまたはyamlで作成する
- パラメータや実行内容を定義できる
- 多くのドキュメントがすでに用意されている

Commandの種類

- Run Command
  - ドキュメント全体を実行したりコマンドを実行する
  - 複数のインスタンスで同時に実行可能
  - IAMやCloudTrailと統合されていて誰が実行したかわかる
  - SSHは不要
  - S3やCloudWatch Logsに出力を転送可能
  - SNSによるコマンドの状態の通知が可能
  - コマンドにタイムアウトを設定して失敗させることもできる。同時に何割のインスタンスにパッチを適用させるかも設定可能 (Error Control, Rate Control)

### Automation

- インスタンスrの再起動やAMIの作成、EBSのスナップショットの取得など

- Runbookw利用する
  
  - 自分で定義する or 定義済みのものを利用する
  
  - コンソールまたはCLIで手動実行、Event Bridgeで定期実行、AWS Configを利用してルール違反の検知をトリガーにして実行するなど

### Parameter Store

- 設定やシークレットをセキュアに保存する

- KMSで暗号化

- サーバレス、スケーラブル

- 設定やシークレットのバージョン管理可能

- EventBridgeで通知可能

- CloudFormationと統合されている

- パラメータを階層構造で管理可能

- アプリケーションがパラメータ全てを取得できるようにしたり、特定のパスのみ取得できるようにするなど制御可能

- 2種類の構造
  
  - Standard
    
    - 10000個のパラメータ、4Kbまで、ポリシー設定不可、無料
  
  - Advanced
    
    - 100000個のパラメータ、8Kbまで、ポリシー設定可能、有料
    
    - TTLで有効期限を設定可能、EventBridgeで有効期限を通知可能

### Inventory

- EC2やオンブレからメタデータを収集する。コンソールで表示したりS3にためてAthenaで検索が可能

- 複数のアカウントやリージョンからデータを収集することも可能

### State Manager

- マネージドインスタンスを定義した状態に維持するために利用される

- ソフトウェアのパッチやOSのアップデートの自動化など

### Patch Manager

- OSやソフトウェア、セキュリティのアップデートのプロセスを自動化

- Patch Baseline：すべき、しないべきパッチを定義する。パッチのリリース数日後に自動実行される

- Patch Group：インスタンスと特定のPatch Baselineと紐づけるもの。インスタンスは1つのGroupまでに所属し、Groupは1までのBaselineと紐づける

### Maintenance Windows

- インスタンスにいつパッチを適用するかや、どの期間パッチを適用するかなどのスケジュールを定義する

### Session Manager

- コンソールやAWS CLIを通じてEC2やオンプレミスサーバにSSHする

- SSHの鍵などは不要

- 実行されたコマンドはS3やCloudWatch Logsに保存可能

- IAMを使って、アクセス可能なユーザやインスタンスの制御ができる

- ユーザが実行可能なコマンドも制御できる

- Port22を許可するインバウンドルールを設定する必要はない
