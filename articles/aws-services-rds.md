---
title: "AWS試験対策: RDS"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

## メモ

- Error Establishing a Database Connectionは、データベースに接続できない時のエラー。RDSのセキュリティグループで接続元からの受信ルールが設定されていないか、使用ポートとRDSで指定されるポートが一致していないか。
- Storageを自動で拡張できる。最大値の閾値をしておく必要がある
- リードレプリカはデータの読み取りを拡張する。最大15個まで。AZは一緒でも跨っても平気。クロスリージョンも可能。クロスリージョンの場合は同期が有料。
- Multi AZは、別のAZにあるスタンバイ・データベースに同期する。フェールオーバーでマスターデータベースに昇格する。リードレプリカを利用することもできる。
- プライマリDBからセカンダリにフェールオーバーする時は、OSのパッチが適用できない時や、ネットワーク到達性がない時やBusyな時など
- LambdaはVPCの外で実行されるので、パブリックサブネットにあるインスタンスにしかアクセスできない。プライベートサブネットにあるRDSにアクセスするには、LambdaにAWSLambdaVPCAccessExecutionRoleを適用して、プライベートサブネットにENIを作成して、RDSにアクセスできるようにする。
- Lambdaの同時実行などで接続数が多すぎるとTooManyConnectionsの例外が発生する。RDS Proxyを経由することでこのエラーを解決できる。またRDS Proxyのみパブリックサブネットに配置することで、LambdaがVPCの外からでもアクセスできるようになる
- パラメータグループでRDSの設定を定義できる。動的パラメータの場合は、パラメータ変更後にインスタンスの再起動が不要になる。force_SSLは試験に出る

### Aurora

- AuroraはRDSと似ているが、レプリケーションやフェールオーバが早いほか、性能がいい。少し高い
- AuroraはWriterEndpointとReaderEndpointを持つ。WriterEndpointはマスターインスタンスと繋がり書き込みができる。ReaderEndpointはすべてのリードレプリカに負荷分散してくれる
- リードレプリカには優先度をつけられる。フェールオーバの優先度となる

## Elasticache

- REDIS
  
  - multi AZ、自動フェールオーバ
  
  - リードレプピカはスケール可能、高可用
  
  - バックアップやリストアができる

- MEMCACHED
  
  - バックアップやリストアはない
  
  - 可用性も低い
  
  - マルチスレッド

- プライマリノードが1つ、レプリカは最大5つ

- 垂直スケーリングすると、ノードタイプのスケールを変更できるが、実際にはノードの再作成になる。新しいノードにデータをレプリケーションしてDNSを変更する。