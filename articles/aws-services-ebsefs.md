---
title: "AWS試験対策: EFS/EBS"
emoji: "🐥"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["aws", "aws認定", "efs", "ebs"]
published: false
---

# 概要

- EBS
  
  - 実行中のインスタンスに付けられるネットワークドライブ
  
  - 特定のAZにマウントされる
    
    - デフォルトではEC2の削除と同時にEBSも削除される (ルートボリューム)。Delete on Termination属性を無効化すると削除されない。データを保持できる

- EC2 Instance Store
  
  - 高性能なハードウェアディスク
  
  - 良いI/O性能
  
  - EC2を止めたらストレージは消える。キャッシュや一時的なコンテンツの保存に適している

- EFS
  
  - 複数のEC2がマウント可能なマネージドなファイルシステム
  
  - EFSとEC2は異なるAZでも可なのでmulti AZ対応
  
  - 高可用、スケーラブル、高い
  
  - セキュリティグループを指定する必要がある。
  
  - Linuxnのみ。Windows不可。
  
  - KMSで暗号化可能
  
  - 自動で拡張される

## EBS

### EBS Volume Type

| Type                 |                                                                                                                                                                        |
| -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| General Purpose SSD  | 低遅延でコスパのいいストレージ。<br/>gp3は新しいバージョン。3000IOPSと125MiB/sのスループット。最大16000IOPSで1000MiB/s。IOPSとスループットはリンクしない<br/>gp2は古いバージョン。3000IOPSまでバーストできる。ボリュームサイズとIOPSがリンクしていて最大16000IOPS |
| Provisioned IOPS SSD | IOPS性能を維持する必要がある重要なビジネスアプリケーションなど16000以上のIOPSが必要な場面で利用される。<br/>io1は4GiB-16TiBで最大PIOPSは64000。そのほかで32000。<br/>io2は最大64TiB。最大PIOPSは256000。<br/>EBSマルチアタッチに対応              |
| HDD                  | ブートリュームにはなれない。データウェアハウスなどに利用。<br/>st1はデータウェアハウスなどに利用。最大スループットは500MiB/sでIOPSは500<br/>Cold HDD (sc1)は頻繁にアクセスされないデータに適している。安くしたい場合                                        |

### EBS Multi-Attach

- 同じAZにある複数のEC2インスタンスにアタッチできる。io1とio2のみ利用可能。

- 同じボリュームに同時に最大16のインスタンスを接続できる

### Resize Volume

- EBSは拡張可能。どのタイプでもサイズの拡張は可能。IOPSの向上はio1のみ

- EBSを拡張したら、パーティションの変更をする必要がある

- EBSは小さくすることはできないので、小さくしたかったら小さいEBSボリュームを新規作成して、データを移行させる必要がある

### EBS Snapshots

- EBSのバックアップを作成する。

- スナップショットの作成の際にデタッチの必要はないが推奨されている

- スナップショットはAZやRegionを超えてコピー可能

- Amazon Data Lifecycle Manger
  
  - EBS snapshotsの作成や削除、保持の自動化
  
  - バックアップの定期実行やクロスアカウントのコピーや古いsnapshotsの削除など
  
  - Tagを利用する
  
  - Fast Snapshots Restore：高いけどEBSがすぐ利用できるようになる

- EBS snapshots archiveに移動させると75%やすくなるが、アーカイブから復元するのに24~72時間かかるようになる

### EBS 暗号化

- 暗号化されたEBSボリュームを作成すると、データが暗号化される。

- インスタンスとボリューム間のデータの移動も暗号化

- スナップショットも暗号化される

- 暗号化にはKMS (AES-256)を利用する

- 暗号化されていないEBSを暗号化するには、暗号化されていないsnapshotを作成し、snapshotをコピーする段階で暗号化する

## EFS

### Performance Mode

| Mode            |                         |
| --------------- | ----------------------- |
| General Purpose | デフォルト。ウェブサーバやCMSに利用される。 |
| Max I/O         | 低遅延、高いスループット。ビッグデータなど   |

### Throughput Mode

| Mode        |                                                                    |
| ----------- | ------------------------------------------------------------------ |
| Bursting    | 50MiB/s。100MiB/sまでバースト可能                                           |
| Provisioned | 1TBのストレージで最大1GiB/sまで出せる                                            |
| Elastic     | スループットが自動でスケーリングされる。Readは最大3GiB/s、Writeは最大1GiB/s。予測できないワークロードに利用する |

### Storage Class

| Tier              |                              |
| ----------------- | ---------------------------- |
| Standard          | 頻繁にアクセスされるファイルに利用            |
| Infrequent access | ファイルの保存料金は安くなるが、呼び出しの料金が高くなる |
| Archive           | 年に数回しかアクセスされないデータに利用。50%安くなる |

- 適切なライフサイクルポリシーを設定することで、ファイルのアクセス頻度に応じてクラスを変更可能

- One Zoneを選択すると一つのAZでのみ利用可能となるが、安価になる

### CloudWatchメトリクス

- PercentIOLimit
  
  - ファイルシステムのI/Oの限界にどのくらい迫っているか
  
  - 100%になったらMax I/Oへの移行をしたほうがいい (途中からMax IOに変更できないので、Max IOのEFSを作成してDataSyncでデータ移行する)

- BurstCreditBalance
  
  - スループットを向上するためにクレジットを利用できる
  
  - クレジットがなくなったら補充を待つ必要がある

- StorageByte
  
  - ファイルシステムのサイズ

### その他

- IAMポリシーを利用することでアクセス可能なパスを制御する。

- EFSからデータ移行する場合はDataSyncを利用する

## EBS vs EFS

| EBS                                                                      | EFS                                |
| ------------------------------------------------------------------------ | ---------------------------------- |
| io1/2のmulti attachを除き、一つのインスタンスにのみアタッチ可能                                 | 大量のEC2インスタンスでマウント可能                |
| AZに紐づけられる。同一AZのインスタンスのみ利用可能。他AZに移動するにはスナップショットを作成して、スナップショットをコピーする必要がある。 | AZを跨いで利用可能                         |
| gp2はサイズを拡張するとIO性能が向上する。gp3とio1はサイズとIO性能が独立している                           | EBSより高価だが、storege Tierを変更することで節約可能 |
